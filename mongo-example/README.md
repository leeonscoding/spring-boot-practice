# Spring data mongodb example in a spring boot project

## Initialize the project
* Go to the start.spring.io [page](https://start.spring.io/ "spring boot project generator")
* Select
    * **Build Tool**: Gradle - Groovy
    * **Language**: Java
    * **Spring Boot Version**: 3.1.0
    * **Packaging**: Jar
    * **Java Version**: 17
* Fill the metadata part as your own
* Select Dependecies
    * **Spring WEB**(spring-boot-starter-web): Contains Spring MVC and embedded Tomcat container
    * **Spring Data MongoDB**(spring-boot-starter-data-mongodb)
    * Lombok, for generating getters and setters and constructors.
* Click the **GENERATE** Button
* Copy the compressed file to a desired location
* Unzip it
## Configure and start the mongodb server
* Define mongo and mongo-express(for db visualization) in a docker-compose.yaml file
    ```yaml
    version: '3.1'

    services:

    mongo:
        image: mongo
        restart: always
        volumes:
        - /data:/data/db
        ports:
        - 27017:27017
        environment:
        MONGO_INITDB_ROOT_USERNAME: root
        MONGO_INITDB_ROOT_PASSWORD: example

    mongo-express:
        image: mongo-express
        restart: always
        ports:
        - 8081:8081
        environment:
        ME_CONFIG_MONGODB_ADMINUSERNAME: root
        ME_CONFIG_MONGODB_ADMINPASSWORD: example
        ME_CONFIG_MONGODB_URL: mongodb://root:example@mongo:27017/
    ```
* Run the command to start those containers
    ```bash
    docker-compose up -d
    ```
## Configure Datasource
* Add the database url in the application.yaml file
    ```yaml
    spring:
      data:
        mongodb:
          uri: mongodb://root:example@localhost:27017/employee
    ```
    The format is: mongodb://user:password@host:port/db_name
## Define a model class
* A simple POJO class
    ```java
    @Data
    @Builder
    public class Employee {
        @Id
        private String id;
        private String name;
        private String email;
        private String role;
    }
    ```
    Here I've defined all args construtor, no args constructor, getters and setters using the @Data annotation of Lombok. Also I've defined the builder class of Employee using the @Builder annotation of Lombok.
    The Id indicates the value of this filed is generated by mongo internally.
## Querying data: the Spring Data api
* Spring Data uses the commom repository interface for data queries. For mongo, Spring Data provides a special Repository interface called the MongoRepository. This 
* Spring Data uses the commom repository interface for data queries. For mongo, Spring Data provides a special Repository interface called the MongoRepository. This MongoRepository extends the ListCrudRepository, ListPagingAndSortingRepository and the QueryByExampleExecutor interfaces. So, we have the necessary methods for CRUD operations, paging and sorting and also filtering.
    ```java
    public interface EmployeeRepository extends MongoRepository<Employee, String> {
    }
    ```
    This MongoRepository is a marker interface. It will generat most of the common CRUD definations like findAll, findOne, findByName, save etc By the Model classes and their fields.
## Setup the Rest controller
```java
@RestController
@RequestMapping("/")
public class EmployeeController {

    @Autowired
    EmployeeRepository employeeRepository;

    @PostMapping("/add")
    public ResponseEntity<HttpStatus> addEmployee(@RequestBody Employee employee) {
        employeeRepository.save(employee);

        return new ResponseEntity<>(HttpStatus.CREATED);
    }

    @GetMapping
    public ResponseEntity<List<Employee>> getAllEmployees() {
        return new ResponseEntity<>(employeeRepository.findAll(), HttpStatus.OK);
    }
    
}
```
Here I've used the save() and findAll() methods. I've Injected the EmployeeRepository interface using the @Autowired annotation.

## Testing
* Add an employee
```bash
curl -H "Content-Type: application/json" -X "POST" -d '{"name": "test1", "email": "test1@mail.com", "role": "tester"}' http://localhost:8080/add
```
* Get all employees
```bash
curl http://localhost:8080
```
